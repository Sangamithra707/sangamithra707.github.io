<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Details | 3D Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <style>
        /* Detail Page Specific Styles */
        .detail-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--space-xl);
            padding: var(--space-xl) 0;
            height: calc(100vh - 100px);
        }

        .viewer-stage {
            background-color: var(--bg-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #main-viewer {
            width: 100%;
            height: 100%;
        }

        .details-panel {
            overflow-y: auto;
            padding-right: var(--space-xs);
        }

        .detail-header h1 {
            font-size: 2rem;
            margin-bottom: var(--space-xs);
        }

        .detail-category {
            color: var(--accent-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.875rem;
            margin-bottom: var(--space-md);
            display: block;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin: var(--space-xl) 0;
            background: var(--bg-surface);
            padding: var(--space-md);
            border-radius: var(--radius-md);
        }

        .spec-item {
            display: flex;
            flex-direction: column;
        }

        .spec-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .spec-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-xl);
        }

        .action-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
            font-weight: 500;
        }

        .back-btn:hover {
            color: var(--text-primary);
        }

        @media (max-width: 900px) {
            .detail-layout {
                grid-template-columns: 1fr;
                height: auto;
            }

            .viewer-stage {
                height: 50vh;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <header class="header">
            <a href="index.html" class="logo">
                <i class="ph-bold ph-cube"></i>
                <span>ALEX RENDER</span>
            </a>
            <nav class="nav-links">
                <a href="#" class="nav-link">Work</a>
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link">Contact</a>
            </nav>
        </header>

        <a href="index.html" class="back-btn"><i class="ph-bold ph-arrow-left"></i> Back to Gallery</a>

        <main class="detail-layout" id="detail-app">
            <div class="left-column" style="display: flex; flex-direction: column; gap: 16px;">
                <section class="viewer-stage" style="height: 500px;">
                    <div id="main-viewer" style="width: 100%; height: 100%;"></div>
                    <img id="image-viewer"
                        style="display: none; width: 100%; height: 100%; object-fit: contain; padding: 20px;">
                </section>

                <!-- Thumbnails Strip -->
                <div id="thumbnails-strip"
                    style="display: flex; gap: 12px; height: 80px; overflow-x: auto; padding-bottom: 4px;">
                    <!-- 3D Toggle Button -->
                    <div id="thumb-3d" class="thumb-item active"
                        style="min-width: 80px; height: 100%; background: var(--bg-surface); border: 2px solid var(--accent-primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        <i class="ph-bold ph-cube" style="font-size: 32px; color: var(--accent-primary);"></i>
                    </div>
                </div>
            </div>

            <section class="details-panel">
                <span class="detail-category" id="d-category">Environment</span>
                <div class="detail-header">
                    <h1 id="d-name">Cyberpunk Kiosk</h1>
                </div>

                <div class="specs-grid">
                    <div class="spec-item">
                        <span class="spec-label">Poly Count</span>
                        <span class="spec-value" id="d-poly">24.5k</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Vertices</span>
                        <span class="spec-value">26.1k</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Texture</span>
                        <span class="spec-value">4K PBR</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Format</span>
                        <span class="spec-value">GLB, FBX</span>
                    </div>
                </div>

                <div class="description">
                    <p id="d-desc">High-fidelity 3D asset optimized for real-time rendering engines. Features clean
                        topology, non-overlapping UVs, and PBR textures including Diffuse, Roughness, Normal, and
                        Metallic maps.</p>
                </div>

                <div class="action-actions">
                    <button class="btn btn-primary" style="justify-content: center; width: 100%;">
                        <i class="ph-bold ph-download-simple" style="margin-right: 8px;"></i> Download Spec Sheet
                    </button>
                    <button class="btn" id="marketplace-link"
                        style="border: 1px solid var(--border-subtle); color: var(--text-primary); justify-content: center;">
                        View on MarketPlace
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script type="module">
        import { Viewer } from './js/viewer.js';

        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        async function initDetail() {
            try {
                const response = await fetch('assets/gallery.json');
                const models = await response.json();
                const data = models.find(m => m.id === id);

                if (data) {
                    document.getElementById('d-name').innerText = data.title;
                    document.getElementById('d-category').innerText = data.category;
                    document.getElementById('d-poly').innerText = data.polyCount;
                    document.getElementById('d-desc').innerText = data.description || 'No description available.';
                    document.title = `${data.title} | 3D Portfolio`;

                    // Update specs
                    const specs = document.querySelectorAll('.spec-value');
                    if (specs[2]) specs[2].innerText = data.textureSize || 'N/A';
                    if (specs[3]) specs[3].innerText = (data.formats || []).join(', ');

                    // Update Link
                    const linkBtn = document.getElementById('marketplace-link');
                    if (linkBtn && data.marketplaceLink) {
                        linkBtn.onclick = () => window.open(data.marketplaceLink, '_blank');
                    }

                    // Init Viewer
                    const viewer = new Viewer('main-viewer');
                    if (data.modelUrl) {
                        viewer.loadModel(data.modelUrl);
                    } else {
                        viewer.loadPlaceholder();
                    }
                    viewer.controls.enableZoom = true;

                    // --- Gallery / Slider Logic ---
                    const mainViewer = document.getElementById('main-viewer');
                    const imageViewer = document.getElementById('image-viewer');
                    const start3D = document.getElementById('thumb-3d');

                    // Reset UI logic
                    const resetView = () => {
                        mainViewer.style.display = 'none';
                        imageViewer.style.display = 'none';
                        document.querySelectorAll('.thumb-item').forEach(el => el.style.border = '2px solid transparent');
                    };

                    // 3D Button Click
                    start3D.addEventListener('click', () => {
                        resetView();
                        mainViewer.style.display = 'block';
                        start3D.style.borderColor = 'var(--accent-primary)';
                    });

                    if (data.images && data.images.length > 0) {
                        const strip = document.getElementById('thumbnails-strip');

                        data.images.forEach(imgUrl => {
                            const thumb = document.createElement('div');
                            thumb.className = 'thumb-item';
                            thumb.style.cssText = `
                                min-width: 80px; height: 100%; 
                                background-image: url('${imgUrl}'); 
                                background-size: cover; background-position: center; 
                                border-radius: 8px; cursor: pointer; border: 2px solid transparent; opacity: 0.7; transition: opacity 0.2s;
                            `;
                            thumb.addEventListener('mouseover', () => thumb.style.opacity = '1');
                            thumb.addEventListener('mouseout', () => { if (imageViewer.src !== window.location.origin + '/' + imgUrl) thumb.style.opacity = '0.7'; });

                            thumb.addEventListener('click', () => {
                                resetView();
                                imageViewer.style.display = 'block';
                                imageViewer.src = imgUrl;
                                thumb.style.borderColor = 'var(--accent-primary)';
                                thumb.style.opacity = '1';
                            });
                            strip.appendChild(thumb);
                        });
                    }
                } else {
                    document.querySelector('.detail-layout').innerHTML = "<h1>Model not found</h1>";
                }
            } catch (e) {
                console.error("Error loading model details", e);
            }
        }

        document.addEventListener('DOMContentLoaded', initDetail);
    </script>
</body>

</html>